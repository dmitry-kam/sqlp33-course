# Домашние задания

В dratft-* запросы-примеры с лекций.

## 1. Командная строка. DCL и TCL
```
Задание 1. Работа с командной строкой
1.1. Создайте новую базу данных с любым названием
1.2. Восстановите бэкап учебной базы данных в новую базу данных с помощью psql
1.3. Выведите список всех таблиц восстановленной базы данных
1.4. Выполните SQL-запрос на выборку всех полей из любой таблицы восстановленной базы данных
Пункты 1.1 и 1.2 выполняются в командной строке, пункты 1.3 и 1.4 выполняются в интерактивном режиме.

Задание 2. Работа с пользователями
2.1. Создайте нового пользователя MyUser, которому разрешен вход, но не задан пароль и права доступа.
2.2. Задайте пользователю MyUser любой пароль сроком действия до последнего дня текущего месяца.
2.3. Дайте пользователю MyUser права на чтение данных из двух любых таблиц восстановленной базы данных.
2.4. Заберите право на чтение данных ранее выданных таблиц
2.5. Удалите пользователя MyUser.
Задание выполняется в DBeaver

Задание 3. Работа с транзакциями
3.1. Начните транзакцию
3.2. Добавьте в таблицу projects новую запись
3.3. Создайте точку сохранения
3.4. Удалите строку, добавленную в п.3.2
3.5. Откатитесь к точке сохранения
3.6. Завершите транзакцию.
Задание выполняется в DBeaver

По заданиям 1.3 и 1.4 в качестве решения пришлите скриншоты.
По заданиям 1.1, 1.2, 2.х и 3.х решение должны быть в виде одного sql файла со всеми командами.
```

## 2. Процедуры и функции

```
Цель домашнего задания:

закрепить навыки создания функций, процедур, триггеров в PostgreSQL
Все задания следует выполнять в базе данных HR

Задание 1. Напишите функцию, которая принимает на вход название должности (например, стажер), а также даты периода поиска, и возвращает количество вакансий, опубликованных по этой должности в заданный период.

Задание 2. Напишите триггер, срабатывающий тогда, когда в таблицу position добавляется значение grade, которого нет в таблице-справочнике grade_salary. Триггер должен возвращать предупреждение пользователю о несуществующем значении grade.

Задание 3. Создайте таблицу employee_salary_history с полями:

emp_id - id сотрудника
salary_old - последнее значение salary (если не найдено, то 0)
salary_new - новое значение salary
difference - разница между новым и старым значением salary
last_update - текущая дата и время
Напишите триггерную функцию, которая срабатывает при добавлении новой записи о сотруднике или при обновлении значения salary в таблице employee_salary, и заполняет таблицу employee_salary_history данными.

Задание 4. Напишите процедуру, которая содержит в себе транзакцию на вставку данных в таблицу employee_salary. Входными параметрами являются поля таблицы employee_salary.
```

## 3. Зависимости. Нормализация. Денормализация

```
Необходимо нормализовать исходную таблицу (выдается в виде csv). 
Получившиеся отношения должны быть не ниже 3 Нормальной Формы.
В результате должна быть диаграмма из не менее чем 5 нормализованных отношений и 1 таблицы с историчностью, соответствующей требованиям SCD4.
Контролировать целостность данных в таблице с историчными данными необходимо с помощью триггерной функции.
Результат работы должен быть в виде одного скриншота ER-диаграммы и sql запроса с триггером и функцией.
```

## 4. Основы проектирования

```
Проектирование БД для аптеки

Сущности:
loyalty_card - карты лояльности (дает процент скидки в зависимости от общей суммы покупок за все время)
purchases - закупки
sales - продажи
staff - сотрудники
manufacturers - производители
categories - категории (реализация по желанию)
suppliers - поставщики (рейтинг - тип данных enum)
product_list - справочник товаров, описание наименования. 
product_fact - фактический товар, каждая позиция - это отдельный кортеж. То есть каждая упаковка лекарства - отдельная запись в базе.
decommissioned_product - списанные товары

Задачи, которые нужно решить:
Финансовое планирование, расчет прибыли.
Актуализация товара в зависимости от спроса.				
Учет рабочего времени сотрудников, анализ квалификации и эффективности сотрудников.
Контроль поставщиков
Учет товара

Домашнее задание:
Необходимо реализовать логическую схему базы. 
На логическом уровне должна быть детализирована концептуальная схема. Нормализованы отношения и сформированы все необходимые связи. Сформированы необходимые атрибуты, конкретизированы типы данных и все необходимые ограничения. При необходимости сформирована денормализация и учтена историчность. Можно словами прописать, какие нужно создать процедуры и функции для автоматизации, какие уровни доступа будут, сколько потребуется серверов и какие типы СУБД можно использовать.
Необходимо:
Детализировать каждое отношение.
Детализировать все связи многие ко многим.
Детализировать должности сотрудников.
Реализовать историчность окладов, должностей и поставщиков в 4 типе SCD.
Либо словами, либо кодом описать формирование значений в атрибуты amount отношений sales и purchases.
Либо словами, либо кодом описать формирование изменения значения скидки в отношении loyalty_card.
Либо словами, либо кодом описать формирование изменения рейтинга по поставщику.

Логическую схему можно отрисовать в https://dbdiagram.io/, https://sqldbm.com, можно реализовать написав и выполнив все запросы в DBeaver. На проверку присылаете скриншот получившейся диаграммы и текстовый документ с дополнениями, комментариями и предложениями.

Задание творческое и не имеет четкого шаблона выполнения.

```

## 5. PostgreSQL Extensions

```
Задание 1. Создайте подключение к удаленному облачному серверу базы HR (база данных postgres, схема hr), используя модуль postgres_fdw.
Напишите SQL-запрос на выборку любых данных используя 2 сторонних таблицы, соединенных с помощью JOIN.
В качестве ответа на задание пришлите список команд, использовавшихся для настройки подключения, создания внешних таблиц, а также получившийся SQL-запрос.

Задание 2. С помощью модуля tablefunc получите из таблицы projects базы HR таблицу с данными, колонками которой будут: год, месяцы с января по декабрь, общий итог по стоимости всех проектов за год.
В качестве ответа на задание пришлите получившийся SQL-запрос.

Задание 3. Настройте модуль pg_stat_statements на локальном сервере PostgresSQL и выполните несколько любых SQL-запросов к базе.
В качестве ответа на задание пришлите скриншот со статистикой по выполненным запросам.
```

## 6. Масштабирование

```
"Задание 1. Выполните горизонтальное партиционирование для таблицы inventory учебной базы dvd-rental:

создайте 2 партиции по значению store_id
создайте индексы для каждой партиции
заполните партиции данными из родительской таблицы
для каждой партиции создайте правила на внесение, обновление, удаление данных. Напишите команды SQL для проверки работы правил.
Задание 2. Создайте новую базу данных и в ней 2 таблицы для хранения данных по инвентаризации каждого магазина, которые будут наследоваться из таблицы inventory базы dvd-rental. Используя шардирование и модуль postgres_fdw создайте подключение к новой базе данных и необходимые внешние таблицы в родительской базе данных для наследования. Распределите данные по внешним таблицам. Напишите SQL-запросы для проверки работы внешних таблиц.

В качестве ответов на задания пришлите текст команд, использовавшихся для выполнения задания, и скриншоты рабочей области с получившимися партициями, внешними таблицами, SQL-запросами и их результатами."
```

## 7. Итоговая

```
Цели итогового проекта
Закрепить, применить на практике знания, полученные на курсе SQL PRO. Реализовать облачную базу данных PostgreSQL для хранения и получения данных.

Описание кейса
В компании периодически возникает необходимость доставки корреспонденции контрагентам. Появился запрос на создание функционала по заказу курьера.
Необходимо реализовать хранение и получение данных по заявкам.
На данный момент уже реализованы фронтенд и бэкенд.
```
